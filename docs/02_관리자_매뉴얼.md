# BAIKAL Groupware AI — 관리자 매뉴얼

> **문서 버전:** 1.0  
> **최종 수정일:** 2026-02-27  
> **대상:** 시스템 관리자, IT 운영팀

---

## 목차

1. [시스템 요구사항](#1-시스템-요구사항)
2. [설치 및 배포](#2-설치-및-배포)
3. [환경 설정](#3-환경-설정)
4. [기본 계정 관리](#4-기본-계정-관리)
5. [서버 운영](#5-서버-운영)
6. [AI Agent 설정](#6-ai-agent-설정)
7. [데이터베이스 관리](#7-데이터베이스-관리)
8. [보안 관리](#8-보안-관리)
9. [문제 해결 (Troubleshooting)](#9-문제-해결-troubleshooting)
10. [백업 및 복구](#10-백업-및-복구)

---

## 1. 시스템 요구사항

### 1.1 로컬 개발 환경

| 항목 | 최소 사양 | 권장 사양 |
|------|----------|----------|
| OS | Windows 10 / macOS 12 / Ubuntu 20.04 | Windows 11 / macOS 14 / Ubuntu 24.04 |
| CPU | 2 Core | 4 Core 이상 |
| RAM | 4 GB | 8 GB 이상 |
| 디스크 | 5 GB 여유 | 10 GB 이상 |
| Python | 3.11 이상 | 3.11.x |
| Node.js | 18.x 이상 | 20.x LTS |
| npm | 9.x 이상 | 10.x |

### 1.2 Docker 배포 환경

| 항목 | 최소 사양 | 권장 사양 |
|------|----------|----------|
| Docker | 24.0 이상 | 최신 안정 버전 |
| Docker Compose | v2.20 이상 | 최신 버전 |
| CPU | 2 Core | 4 Core 이상 |
| RAM | 4 GB | 8 GB 이상 |
| 디스크 | 10 GB | 20 GB 이상 |

### 1.3 네트워크

| 포트 | 서비스 | 설명 |
|------|--------|------|
| 8000 | Backend (FastAPI) | REST API |
| 3000 | Frontend (Vite Dev) | 개발 서버 |
| 80 | Frontend (Nginx) | Docker 프로덕션 |
| 5432 | PostgreSQL | Docker DB |
| 443 | HTTPS | 프로덕션 (선택) |

---

## 2. 설치 및 배포

### 2.1 로컬 개발 모드 (SQLite)

#### Step 1: 프로젝트 클론
```bash
git clone <repository-url> baikal-groupware-ai
cd baikal-groupware-ai
```

#### Step 2: 환경 변수 설정
```bash
cp .env.example .env
```

`.env` 파일을 편집합니다:
```env
LLM_PROVIDER=openai
OPENAI_API_KEY=sk-your-openai-key-here
DATABASE_URL=sqlite+aiosqlite:///./baikal_groupware.db
SECRET_KEY=your-random-secret-key-here
```

#### Step 3: Backend 설치 및 실행
```bash
cd backend
pip install -r requirements.txt
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

> **참고:** 최초 실행 시 데이터베이스 테이블과 기본 사용자가 자동으로 생성됩니다.

#### Step 4: Frontend 설치 및 실행
```bash
cd frontend
npm install
npm run dev -- --port 3000
```

#### Step 5: 접속 확인
- 프론트엔드: `http://localhost:3000`
- 백엔드 API 문서: `http://localhost:8000/docs` (Swagger UI)
- 헬스체크: `http://localhost:8000/api/health`

### 2.2 Docker 배포 (PostgreSQL)

#### Step 1: 환경 변수 설정
```bash
cp .env.example .env
# .env 파일에서 아래 항목을 반드시 수정:
# - OPENAI_API_KEY
# - SECRET_KEY (프로덕션용으로 강력한 랜덤 키 사용)
# - DATABASE_URL (docker-compose.yml에서 자동 설정됨)
```

#### Step 2: 빌드 및 실행
```bash
docker-compose up -d --build
```

#### Step 3: 상태 확인
```bash
docker-compose ps          # 컨테이너 상태 확인
docker-compose logs -f     # 실시간 로그
docker-compose logs backend # 백엔드 로그만 확인
```

#### Step 4: 서비스 중지
```bash
docker-compose down        # 서비스 중지
docker-compose down -v     # 서비스 중지 + 데이터 볼륨 삭제
```

---

## 3. 환경 설정

### 3.1 환경 변수 상세

| 변수명 | 필수 | 기본값 | 설명 |
|--------|------|--------|------|
| `LLM_PROVIDER` | ✓ | `openai` | AI 모델 제공자. `openai` 또는 `ollama` |
| `OPENAI_API_KEY` | △ | (없음) | OpenAI 사용 시 필수. sk-로 시작하는 API 키 |
| `OPENAI_MODEL` | ✗ | `gpt-4o` | 사용할 OpenAI 모델명 |
| `OLLAMA_BASE_URL` | △ | `http://localhost:11434` | Ollama 사용 시 서버 주소 |
| `OLLAMA_MODEL` | ✗ | `llama3.1:8b` | Ollama 모델명 |
| `DATABASE_URL` | ✓ | `sqlite+aiosqlite:///./baikal_groupware.db` | 데이터베이스 연결 문자열 |
| `SECRET_KEY` | ✓ | `baikal-secret-key-change-in-production` | JWT 서명용 비밀 키 |
| `BACKEND_URL` | ✗ | `http://localhost:8000` | 백엔드 URL |

> ⚠️ **보안 경고:** 프로덕션 환경에서는 반드시 `SECRET_KEY`를 **강력한 랜덤 문자열**(최소 32자)로 변경하세요.

### 3.2 AI Provider 설정 가이드

#### OpenAI 사용 시
```env
LLM_PROVIDER=openai
OPENAI_API_KEY=sk-proj-xxxxxxxxxxxx
OPENAI_MODEL=gpt-4o      # 또는 gpt-4o-mini, gpt-3.5-turbo
```

#### Ollama 사용 시 (로컬 LLM)
```env
LLM_PROVIDER=ollama
OLLAMA_BASE_URL=http://localhost:11434
OLLAMA_MODEL=llama3.1:8b
```

Ollama 설치 후 모델 다운로드:
```bash
ollama pull llama3.1:8b
ollama serve  # 서버 시작
```

---

## 4. 기본 계정 관리

### 4.1 초기 시드 계정

시스템 최초 시작 시 아래 계정이 자동 생성됩니다:

| 역할 | 이름 | 이메일 | 비밀번호 | 부서 | 직책 |
|------|------|--------|----------|------|------|
| 관리자 | 관리자 | admin@baikal.ai | admin1234 | 경영지원 | 대표 |
| 일반사용자 | 김철수 | kim@baikal.ai | user1234 | 개발팀 | 팀장 |
| 일반사용자 | 이영희 | lee@baikal.ai | user1234 | 개발팀 | 선임 |
| 일반사용자 | 박지민 | park@baikal.ai | user1234 | 마케팅팀 | 팀장 |
| 일반사용자 | 최민수 | choi@baikal.ai | user1234 | 인사팀 | 과장 |

> ⚠️ **보안 경고:** 프로덕션 배포 후 반드시 기본 비밀번호를 변경하세요.

### 4.2 사용자 추가

신규 사용자는 **회원가입 API**를 통해 추가합니다:

```bash
curl -X POST http://localhost:8000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "newuser@baikal.ai",
    "password": "securepassword",
    "name": "신규사용자",
    "department": "개발팀",
    "position": "사원"
  }'
```

### 4.3 권한 체계

| 역할 | 코드 | 권한 |
|------|------|------|
| 관리자 | `admin` | 모든 기능 + 사용자 관리 |
| 일반사용자 | `user` | 그룹웨어 기능 사용 + AI 채팅 |

---

## 5. 서버 운영

### 5.1 서비스 상태 확인

```bash
# 헬스 체크
curl http://localhost:8000/api/health
# 응답: {"status":"ok"}

# Docker 상태 확인
docker-compose ps
docker-compose logs --tail=50 backend
```

### 5.2 서비스 재시작

```bash
# 로컬 모드: 프로세스 재시작
# Ctrl+C 후 다시 실행

# Docker 모드
docker-compose restart backend   # 백엔드만 재시작
docker-compose restart frontend  # 프론트엔드만 재시작
docker-compose restart           # 전체 재시작
```

### 5.3 로그 확인

```bash
# Docker 로그
docker-compose logs -f backend   # 백엔드 실시간 로그
docker-compose logs -f frontend  # 프론트엔드 실시간 로그

# 로컬 모드: 터미널 출력 확인
# FastAPI는 uvicorn 콘솔에 요청 로그 자동 출력
```

### 5.4 서비스 업데이트

```bash
# 코드 업데이트 후
git pull origin main

# Docker
docker-compose up -d --build

# 로컬
cd backend && pip install -r requirements.txt
cd frontend && npm install && npm run build
```

---

## 6. AI Agent 설정

### 6.1 AI Provider 전환

`.env` 파일에서 `LLM_PROVIDER`를 변경한 후 백엔드를 재시작합니다:

```env
# OpenAI로 전환
LLM_PROVIDER=openai

# Ollama로 전환 (로컬 LLM, API 키 불필요)
LLM_PROVIDER=ollama
```

### 6.2 모델 변경

```env
# OpenAI 모델 변경
OPENAI_MODEL=gpt-4o-mini    # 비용 절감 시

# Ollama 모델 변경
OLLAMA_MODEL=llama3.1:70b   # 높은 성능 필요 시
```

### 6.3 AI 도구 목록 (9개)

AI Agent가 자동으로 사용하는 도구:

| # | 도구 | 기능 |
|---|------|------|
| 1 | `create_approval` | 전자결재 문서 생성 |
| 2 | `create_task` | 업무 생성 및 담당자 할당 |
| 3 | `create_schedule` | 일정 등록 |
| 4 | `create_notice` | 공지사항 작성 |
| 5 | `search_users` | 사용자 검색 |
| 6 | `list_my_approvals` | 내 결재 조회 |
| 7 | `list_my_tasks` | 내 업무 조회 |
| 8 | `list_my_schedules` | 내 일정 조회 |
| 9 | `list_notices` | 공지사항 조회 |

### 6.4 대화 히스토리

- AI Agent는 **최근 20건의 대화**를 컨텍스트로 사용합니다.
- 대화 기록은 `chat_messages` 테이블에 저장됩니다.
- 사용자별로 독립적인 대화 히스토리를 유지합니다.

---

## 7. 데이터베이스 관리

### 7.1 SQLite (로컬 개발)

데이터베이스 파일 위치: `backend/baikal_groupware.db`

```bash
# SQLite CLI로 접속
sqlite3 backend/baikal_groupware.db

# 테이블 목록 확인
.tables

# 사용자 목록 조회
SELECT email, name, role, department FROM users;

# 종료
.quit
```

### 7.2 PostgreSQL (Docker)

```bash
# Docker 컨테이너 내 psql 접속
docker-compose exec postgres psql -U baikal -d baikal_groupware

# 테이블 목록
\dt

# 사용자 조회
SELECT email, name, role, department FROM users;

# 종료
\q
```

### 7.3 데이터 초기화

```bash
# 로컬: DB 파일 삭제 후 재시작 (자동 재생성)
rm backend/baikal_groupware.db
# 백엔드 재실행

# Docker: 볼륨 삭제 후 재시작
docker-compose down -v
docker-compose up -d --build
```

---

## 8. 보안 관리

### 8.1 필수 보안 조치 (프로덕션)

| # | 항목 | 조치 |
|---|------|------|
| 1 | SECRET_KEY 변경 | 32자 이상 랜덤 문자열 사용 |
| 2 | 기본 비밀번호 변경 | 모든 시드 계정 비밀번호 변경 |
| 3 | HTTPS 설정 | Nginx 또는 리버스 프록시에서 SSL 적용 |
| 4 | CORS 설정 | `main.py`에서 허용 도메인 제한 |
| 5 | API Key 보호 | `.env` 파일을 `.gitignore`에 포함 |
| 6 | 방화벽 | 불필요한 포트 차단 (5432 외부 접근 차단) |

### 8.2 SECRET_KEY 생성

```bash
# Python으로 안전한 키 생성
python -c "import secrets; print(secrets.token_urlsafe(64))"
```

### 8.3 CORS 설정

`backend/app/main.py`에서 허용 도메인을 수정합니다:

```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["https://your-domain.com"],  # 운영 도메인만 허용
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

---

## 9. 문제 해결 (Troubleshooting)

### 9.1 백엔드가 시작되지 않음

**증상:** `uvicorn` 실행 시 에러 발생

| 원인 | 해결 방법 |
|------|----------|
| Python 버전 미달 | `python --version`으로 3.11 이상 확인 |
| 의존성 미설치 | `pip install -r requirements.txt` 재실행 |
| 포트 충돌 | `lsof -i :8000` 또는 `netstat -ano` 확인 후 포트 변경 |
| .env 파일 누락 | `.env.example`을 `.env`로 복사 |

### 9.2 프론트엔드 빌드 에러

**증상:** `npm run build` 실패

| 원인 | 해결 방법 |
|------|----------|
| Node.js 버전 | `node -v`로 18.x 이상 확인 |
| 의존성 문제 | `rm -rf node_modules && npm install` |
| 캐시 문제 | `npm cache clean --force` |

### 9.3 AI 채팅이 응답하지 않음

**증상:** AI에 메시지를 보내면 에러 발생

| 원인 | 해결 방법 |
|------|----------|
| OPENAI_API_KEY 미설정 | `.env`에 유효한 API 키 입력 |
| API 키 만료/한도 초과 | OpenAI 대시보드에서 잔액/한도 확인 |
| Ollama 서버 미실행 | `ollama serve` 실행 확인 |
| 네트워크 차단 | 방화벽에서 외부 HTTPS 허용 확인 |

### 9.4 로그인 실패

**증상:** 올바른 자격 증명으로도 로그인 불가

| 원인 | 해결 방법 |
|------|----------|
| DB 미초기화 | 백엔드 재시작 (자동 시드) |
| SECRET_KEY 변경 | 기존 토큰 무효, 재로그인 |
| bcrypt 호환성 | `pip install bcrypt==4.0.1` |

### 9.5 ERR_CONNECTION_REFUSED

**증상:** 브라우저에서 API 호출 시 연결 거부

| 원인 | 해결 방법 |
|------|----------|
| 백엔드 미실행 | `uvicorn app.main:app --port 8000` 확인 |
| CORS 에러 | 브라우저 개발자 도구 → 콘솔 확인 |
| 호스트 바인딩 | `--host 0.0.0.0` 옵션 추가 |

---

## 10. 백업 및 복구

### 10.1 SQLite 백업

```bash
# 파일 복사로 간단 백업
cp backend/baikal_groupware.db backup/baikal_$(date +%Y%m%d).db

# 자동 백업 스크립트 (cron)
0 2 * * * cp /path/to/baikal_groupware.db /backup/baikal_$(date +\%Y\%m\%d).db
```

### 10.2 PostgreSQL 백업

```bash
# 전체 덤프
docker-compose exec postgres pg_dump -U baikal baikal_groupware > backup.sql

# 복구
docker-compose exec -T postgres psql -U baikal baikal_groupware < backup.sql
```

### 10.3 전체 시스템 백업 (Docker)

```bash
# Docker 볼륨 백업
docker run --rm -v baikal-groupware-ai_postgres_data:/data \
  -v $(pwd)/backup:/backup alpine tar czf /backup/db_$(date +%Y%m%d).tar.gz /data
```

---

*© 2026 BAIKAL AI. All rights reserved.*
